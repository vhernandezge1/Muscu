{% extends "training/base.html" %}

{% block title %}Exercices - Muscu{% endblock %}

{% block content %}
<h1>Exercices de Musculation</h1>

<div class="row">
  {% for exercise in exercises %}
  <div class="col-md-4 mb-3">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title">{{ exercise.name }}</h5>
        <h6 class="card-subtitle mb-2 text-muted">{{ exercise.muscle_group }}</h6>
        <p class="card-text">{{ exercise.description }}</p>
        <span class="badge bg-info">{{ exercise.difficulty }}</span>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<hr>

<h3>ðŸ’¬ Chat en direct</h3>

<div id="chat-box" class="border rounded p-3 mb-3" 
     style="height:200px; overflow-y:scroll; background:#fff;">
</div>

<div class="d-flex">
  <input id="chat-message-input" type="text" class="form-control me-2" placeholder="Votre message...">
  <button id="chat-message-submit" class="btn btn-primary">Envoyer</button>
</div>

<script>
  const chatSocket = new WebSocket(
      'ws://' + window.location.host + '/ws/chat/'
  );

  chatSocket.onmessage = function(e) {
      const data = JSON.parse(e.data);
      const chatBox = document.querySelector("#chat-box");
      const msg = document.createElement("div");
      msg.textContent = "ðŸ‘¤ " + data.message;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight; // auto-scroll
  };

  document.querySelector("#chat-message-submit").onclick = function(e) {
      const input = document.querySelector("#chat-message-input");
      if (input.value.trim() !== "") {
          chatSocket.send(JSON.stringify({
              'message': input.value
          }));
          input.value = '';
      }
  };
</script>
{% endblock %}
